{% extends "base.html" %}

{% block title %}Editar Pedido{% endblock %}
{% block header_title %}Editar Pedido #{{ order.order_number }}{% endblock %}

{% block content %}
<div class="max-w-3xl">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <form method="POST">
            <!-- Order Info -->
            <div class="p-4 bg-sand/30 rounded-lg mb-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-xs text-gray-500">Pedido</p>
                        <p class="font-bold text-primary">{{ order.order_number }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Cliente</p>
                        <p class="font-medium">{{ order.get_client_name() }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Valor Total</p>
                        <p class="font-bold text-primary">R$ {{ "%.2f"|format(order.total_value or 0) }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Valor Pago</p>
                        <p class="font-medium text-green-600">R$ {{ "%.2f"|format(order.paid_value or 0) }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Status Section -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Status do Pedido
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select name="status" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                            <option value="created" {{ 'selected' if order.status == 'created' else '' }}>Criado</option>
                            <option value="production" {{ 'selected' if order.status == 'production' else '' }}>Em Produção</option>
                            <option value="ready" {{ 'selected' if order.status == 'ready' else '' }}>Pronto</option>
                            <option value="shipping" {{ 'selected' if order.status == 'shipping' else '' }}>Enviado</option>
                            <option value="delivered" {{ 'selected' if order.status == 'delivered' else '' }}>Entregue</option>
                            <option value="cancelled" {{ 'selected' if order.status == 'cancelled' else '' }}>Cancelado</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Etapa de Produção</label>
                        <select name="production_step" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                            <option value="cutting" {{ 'selected' if order.production_step == 'cutting' else '' }}>Corte</option>
                            <option value="printing" {{ 'selected' if order.production_step == 'printing' else '' }}>Estampa</option>
                            <option value="finishing" {{ 'selected' if order.production_step == 'finishing' else '' }}>Acabamento</option>
                            <option value="quality_check" {{ 'selected' if order.production_step == 'quality_check' else '' }}>Controle de Qualidade</option>
                            <option value="ready" {{ 'selected' if order.production_step == 'ready' else '' }}>Pronto</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Progress Section -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Progresso da Produção</label>
                <div class="flex items-center gap-4">
                    <input type="range" name="progress" id="progress_range" min="0" max="100" value="{{ order.progress }}"
                        class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"
                        oninput="document.getElementById('progress_value').textContent = this.value + '%'">
                    <span id="progress_value" class="w-12 text-right font-medium">{{ order.progress }}%</span>
                </div>
            </div>
            
            <!-- Delivery Section -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                    </svg>
                    Entrega
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Método</label>
                        <select name="delivery_method" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                            <option value="delivery" {{ 'selected' if order.delivery_method == 'delivery' else '' }}>Entrega</option>
                            <option value="pickup" {{ 'selected' if order.delivery_method == 'pickup' else '' }}>Retirada</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Data Prevista</label>
                        <input type="date" name="delivery_date_estimated" 
                            value="{{ order.delivery_date_estimated.strftime('%Y-%m-%d') if order.delivery_date_estimated else '' }}"
                            class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Código de Rastreio</label>
                        <input type="text" name="tracking_code" value="{{ order.tracking_code or '' }}"
                            class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary"
                            placeholder="Se houver">
                    </div>
                </div>
            </div>
            
            <!-- Notes -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Observações</label>
                <textarea name="notes" rows="3"
                    class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary"
                    placeholder="Notas internas sobre o pedido...">{{ order.notes or '' }}</textarea>
            </div>
            
            <div class="flex gap-3">
                <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    Salvar Alterações
                </button>
                <a href="{{ url_for('view_order', id=order.id) }}" class="px-6 py-2 rounded-lg font-medium border border-gray-200 hover:bg-gray-50 transition-colors">
                    Cancelar
                </a>
                <a href="{{ url_for('transactions', order_id=order.id) }}" class="ml-auto px-6 py-2 rounded-lg font-medium text-green-700 bg-green-50 hover:bg-green-100 transition-colors">
                    Ver Transações
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
