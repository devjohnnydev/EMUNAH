{% extends "base.html" %}

{% block title %}{{ 'Editar' if budget else 'Novo' }} Orçamento{% endblock %}
{% block header_title %}{{ 'Editar' if budget else 'Novo' }} Orçamento{% endblock %}

{% block content %}
<div class="max-w-2xl">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <form method="POST">
            <div class="grid gap-4">
                {% if not budget %}
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cotação *</label>
                    <select name="quote_id" required class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                        <option value="">Selecione uma cotação aprovada</option>
                        {% for quote in quotes %}
                        <option value="{{ quote.id }}">#{{ quote.id }} - {{ quote.client.name if quote.client else 'Cliente' }} ({{ quote.total_quantity }} un.)</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cliente *</label>
                    <select name="client_id" required class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                        <option value="">Selecione um cliente</option>
                        {% for client in clients %}
                        <option value="{{ client.id }}">{{ client.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Valor Total *</label>
                        <input type="number" name="total_value" step="0.01" value="{{ budget.total_value if budget else '' }}" required
                            class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Entrada (%)</label>
                        <input type="number" name="down_payment_percent" min="0" max="100" value="{{ budget.down_payment_percent if budget else 50 }}"
                            class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Chave PIX</label>
                    <input type="text" name="pix_key" value="{{ budget.pix_key if budget else '11998896725' }}"
                        class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                </div>
                
                {% if budget %}
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                    <select name="status" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">
                        <option value="draft" {{ 'selected' if budget.status == 'draft' else '' }}>Rascunho</option>
                        <option value="sent" {{ 'selected' if budget.status == 'sent' else '' }}>Enviado</option>
                        <option value="approved" {{ 'selected' if budget.status == 'approved' else '' }}>Aprovado</option>
                        <option value="rejected" {{ 'selected' if budget.status == 'rejected' else '' }}>Rejeitado</option>
                        <option value="cancelled" {{ 'selected' if budget.status == 'cancelled' else '' }}>Cancelado</option>
                    </select>
                </div>
                {% endif %}
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Observações</label>
                    <textarea name="notes" rows="3"
                        class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary">{{ budget.notes if budget else '' }}</textarea>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    {{ 'Atualizar' if budget else 'Criar' }} Orçamento
                </button>
                <a href="{{ url_for('budgets') }}" class="px-6 py-2 rounded-lg font-medium border border-gray-200 hover:bg-gray-50 transition-colors">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
